@using Course.Models
@using Microsoft.AspNet.Identity;
@model Creative

@{
    ViewBag.Title = "Index";
}
<br />
<button type="button" class="btn btn-github" data-toggle="modal" data-target="#createModal">
    <i class="fa fa-plus fa-2x" aria-hidden="true"></i>
</button>

<div id="createModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">@Resources.Resource.NewCreative</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="creative-name" class="form-control-label">@(Resources.Resource.Name):</label>
                        <input type="text" class="form-control" id="creative-name"/>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    @Resources.Resource.Cancel
                </button>
                <button type="button" class="btn btn-primary" id="create_button">
                    @Resources.Resource.Create
                </button>
            </div>
        </div>

    </div>
</div>

<div>
    <table class="table table-striped table-hover">
        <tr>
            <th>
                @Html.Label(nameof(Creative.Id))
            </th>
            <th>
                @Html.Label(nameof(Creative.Name))
            </th>
            <th>
                @Html.Label(nameof(Creative.ApplicationUser))
            </th>
            <th>
                @Html.Label(nameof(Creative.CreationTime))
            </th>
            <th>
                @Html.Label(nameof(Creative.LastEditTime))
            </th>
            <th>
                @Html.Label(nameof(Creative.Views))
            </th>
            <th>
                @Html.Label(nameof(Creative.Rating))
            </th>
            <th>
                @Html.Label(nameof(Creative.RatingsAmount))
            </th>
            <th>
                <p>Stars</p>
            </th>
            <th>
            </th>
            <th>
            </th>
        </tr>

        @foreach (Creative item in ViewBag.Creatives)
        {
            <tr class="success">
                <td>
                    @Html.DisplayFor(i => item.Id)
                </td>
                <td>
                    @Html.ActionLink(item.Name, "View", "User", new { id = item.Id }, null)
                </td>
                <td>
                    @Html.DisplayFor(i => item.ApplicationUser.Email)
                </td>
                <td>
                    @Html.DisplayFor(i => item.CreationTime)
                </td>
                <td>
                    @Html.DisplayFor(i => item.LastEditTime)
                </td>
                <td>
                    @Html.DisplayFor(i => item.Views)
                </td>
                <td>
                    <input class="itemRate" type="hidden" value="@item.Rating" />
                </td>
                <td>
                    
                    @Html.DisplayFor(i => item.RatingsAmount)
                </td>
                <td>
                    <div class="rateYo"></div>
                </td>
                <td>
                    @Html.ActionLink("Edit", "Edit", new { id = item.Id }, new { @class = "btn btn-success"})
                </td>
                <td>
                    @Html.ActionLink("Delete", "Delete", new { id = item.Id }, new { @class = "btn btn-danger" })
                </td>
            </tr>
        }
    </table>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(document).ready(function () {
            $(".rateYo").rateYo({
                starWidth: "40px",
                halfStar: true,
                onInit: function (rating, rateYoInstance) {
                    var rate = $(this).parent().parent().find('.itemRate').val().replace(',', '.');
                    ///console.log("" + rate);
                    $(this).rateYo("option", "rating", rate);
                    $(this).rateYo("option", "readOnly", true);
                }
            });

            $('#create_button').on("click", function () {
                var creative_name = $('#creative-name').val();
                var data = { name: creative_name };

                $.ajax({
                    type: 'POST',
                    async: false,
                    data: data,
                    url: '/User/CreateCreative'
                }).success(function (id) {
                    //window.location.reload(true);
                    window.location.href = "/User/Edit/" + id;
                });
                //console.log("--text--" + name);
            });
        });

    </script>
}




